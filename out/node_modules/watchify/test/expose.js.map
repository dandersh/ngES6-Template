{"version":3,"sources":["../../../../node_modules/watchify/test/expose.js"],"names":[],"mappings":"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","file":"expose.js","sourcesContent":["var test = require('tape');\nvar watchify = require('../');\nvar browserify = require('browserify');\nvar vm = require('vm');\n\nvar fs = require('fs');\nvar path = require('path');\nvar mkdirp = require('mkdirp');\n\nvar os = require('os');\nvar tmpbase = fs.realpathSync((os.tmpdir || os.tmpDir)());\nvar tmpdir = path.join(tmpbase, 'watchify-' + Math.random());\n\nvar files = {\n    main: path.join(tmpdir, 'main.js'),\n    beep: path.join(tmpdir, 'beep.js'),\n    boop: path.join(tmpdir, 'boop.js'),\n    abc: path.join(tmpdir, 'lib', 'abc.js'),\n    xyz: path.join(tmpdir, 'lib', 'xyz.js')\n};\n\nmkdirp.sync(tmpdir);\nmkdirp.sync(path.join(tmpdir, 'lib'));\n\nfs.writeFileSync(files.main, [\n    'var abc = require(\"abc\");',\n    'var xyz = require(\"xyz\");',\n    'var beep = require(\"./beep\");',\n    'console.log(abc + \" \" + xyz + \" \" + beep);'\n].join('\\n'));\nfs.writeFileSync(files.beep, 'module.exports = require(\"./boop\");');\nfs.writeFileSync(files.boop, 'module.exports = require(\"xyz\");');\nfs.writeFileSync(files.abc, 'module.exports = \"abc\";');\nfs.writeFileSync(files.xyz, 'module.exports = \"xyz\";');\n\ntest('properly caches exposed files', function (t) {\n    t.plan(4);\n    var cache = {};\n    var w = watchify(browserify({\n        entries: [files.main],\n        basedir: tmpdir,\n        cache: cache,\n        packageCache: {}\n    }));\n\n    w.require('./lib/abc', {expose: 'abc'});\n    w.require('./lib/xyz', {expose: 'xyz'});\n    w.on('update', function () {\n        w.bundle(function (err, src) {\n            t.ifError(err);\n            t.equal(run(src), 'ABC XYZ XYZ\\n');\n            w.close();\n        });\n    });\n    w.bundle(function (err, src) {\n        t.ifError(err);\n        t.equal(run(src), 'abc xyz xyz\\n');\n        setTimeout(function () {\n            // If we're incorrectly caching exposed files,\n            // then \"files.abc\" would be re-read from disk.\n            cache[files.abc].source = 'module.exports = \"ABC\";';\n            fs.writeFileSync(files.xyz, 'module.exports = \"XYZ\";');\n        }, 1000);\n    });\n});\n\nfunction run (src) {\n    var output = '';\n    function log (msg) { output += msg + '\\n' }\n    vm.runInNewContext(src, { console: { log: log } });\n    return output;\n}\n"]}