{"version":3,"sources":["../../../../node_modules/watchify/test/bin_plugins_pipelining_multiple_errors.js"],"names":[],"mappings":";;AAAA,IAAI,OAAO,QAAQ,MAAR,CAAX;AACA,IAAI,KAAK,QAAQ,IAAR,CAAT;AACA,IAAI,OAAO,QAAQ,MAAR,CAAX;AACA,IAAI,SAAS,QAAQ,QAAR,CAAb;AACA,IAAI,QAAQ,QAAQ,WAAR,CAAZ;AACA,IAAI,QAAQ,QAAQ,OAAR,CAAZ;;AAEA,IAAI,MAAM,KAAK,OAAL,CAAa,SAAb,EAAwB,eAAxB,CAAV;AACA,IAAI,KAAK,QAAQ,IAAR,CAAT;AACA,IAAI,SAAS,KAAK,IAAL,CAAU,CAAC,GAAG,MAAH,IAAa,GAAG,MAAjB,GAAV,EAAsC,cAAc,KAAK,MAAL,EAApD,CAAb;;AAEA,IAAI,QAAQ;AACR,UAAM,KAAK,IAAL,CAAU,MAAV,EAAkB,SAAlB,CADE;AAER,YAAQ,KAAK,IAAL,CAAU,MAAV,EAAkB,WAAlB,CAFA;AAGR,YAAQ,KAAK,IAAL,CAAU,MAAV,EAAkB,WAAlB;AAHA,CAAZ;;AAMA,OAAO,IAAP,CAAY,MAAZ;AACA,GAAG,aAAH,CAAiB,MAAM,MAAvB,EAA+B,CAC3B,sCAD2B,EAE3B,wCAF2B,EAG3B,+CAH2B,EAI3B,+CAJ2B,EAK3B,SAL2B,EAM3B,IAN2B,EAO7B,IAP6B,CAOxB,IAPwB,CAA/B;AAQA,GAAG,aAAH,CAAiB,MAAM,IAAvB,EAA6B,YAA7B;;AAEA,KAAK,wCAAL,EAA+C,UAAU,CAAV,EAAa;AACxD,MAAE,IAAF,CAAO,CAAP;AACA,QAAI,KAAK,MAAM,GAAN,EAAW,CAChB,MAAM,IADU,EAEhB,IAFgB,EAEV,MAAM,MAFI,EAEI,IAFJ,EAGhB,IAHgB,EAGV,MAAM,MAHI,CAAX,CAAT;AAKA,QAAI,UAAU,CAAd;AACA,OAAG,MAAH,CAAU,IAAV,CAAe,OAAf,EAAwB,EAAxB,CAA2B,MAA3B,EAAmC,UAAU,IAAV,EAAgB;AAC/C;AACA,YAAI,YAAY,CAAhB,EAAmB;AACf,cAAE,KAAF,CAAQ,IAAR,EAAc,UAAd;AACH;AACD,YAAI,YAAY,CAAhB,EAAmB;AACf,cAAE,KAAF,CAAQ,IAAR,EAAc,UAAd;AACA,uBAAW,YAAW;AACpB,mBAAG,aAAH,CAAiB,MAAM,IAAvB,EAA6B,YAA7B;AACD,aAFD,EAEG,IAFH;AAGH;AACD,YAAI,YAAY,CAAhB,EAAmB;AACf,cAAE,KAAF,CAAQ,IAAR,EAAc,UAAd;AACH;AACD,YAAI,YAAY,CAAhB,EAAmB;AACf,cAAE,KAAF,CAAQ,IAAR,EAAc,UAAd;AACA,eAAG,IAAH;AACH;AACJ,KAlBD;AAmBH,CA3BD","file":"bin_plugins_pipelining_multiple_errors.js","sourcesContent":["var test = require('tape');\nvar fs = require('fs');\nvar path = require('path');\nvar mkdirp = require('mkdirp');\nvar spawn = require('win-spawn');\nvar split = require('split');\n\nvar cmd = path.resolve(__dirname, '../bin/cmd.js');\nvar os = require('os');\nvar tmpdir = path.join((os.tmpdir || os.tmpDir)(), 'watchify-' + Math.random());\n\nvar files = {\n    main: path.join(tmpdir, 'main.js'),\n    plugin: path.join(tmpdir, 'plugin.js'),\n    bundle: path.join(tmpdir, 'bundle.js')\n};\n\nmkdirp.sync(tmpdir);\nfs.writeFileSync(files.plugin, [\n    'module.exports = function(b, opts) {',\n    '    b.on(\"file\", function (file, id) {',\n    '        b.pipeline.emit(\"error\", \"bad boop\");',\n    '        b.pipeline.emit(\"error\", \"bad boop\");',\n    '    });',\n    '};',\n].join('\\n'));\nfs.writeFileSync(files.main, 'boop\\nbeep');\n\ntest('bin plugins pipelining multiple errors', function (t) {\n    t.plan(4);\n    var ps = spawn(cmd, [\n        files.main,\n        '-p', files.plugin, '-v',\n        '-o', files.bundle\n    ]);\n    var lineNum = 0;\n    ps.stderr.pipe(split()).on('data', function (line) {\n        lineNum ++;\n        if (lineNum === 1) {\n            t.equal(line, 'bad boop');\n        }\n        if (lineNum === 2) {\n            t.equal(line, 'bad boop');\n            setTimeout(function() {\n              fs.writeFileSync(files.main, 'beep\\nboop');\n            }, 1000);\n        }\n        if (lineNum === 3) {\n            t.equal(line, 'bad boop');\n        }\n        if (lineNum === 4) {\n            t.equal(line, 'bad boop');\n            ps.kill();\n        }\n    });\n});\n"]}