{"version":3,"sources":["../../../../node_modules/watchify/test/bin.js"],"names":[],"mappings":";;AAAA,IAAI,OAAO,QAAQ,MAAR,CAAX;AACA,IAAI,KAAK,QAAQ,IAAR,CAAT;AACA,IAAI,OAAO,QAAQ,MAAR,CAAX;AACA,IAAI,SAAS,QAAQ,QAAR,CAAb;AACA,IAAI,QAAQ,QAAQ,WAAR,CAAZ;AACA,IAAI,QAAQ,QAAQ,OAAR,CAAZ;;AAEA,IAAI,MAAM,KAAK,OAAL,CAAa,SAAb,EAAwB,eAAxB,CAAV;AACA,IAAI,KAAK,QAAQ,IAAR,CAAT;AACA,IAAI,SAAS,KAAK,IAAL,CAAU,CAAC,GAAG,MAAH,IAAa,GAAG,MAAjB,GAAV,EAAsC,cAAc,KAAK,MAAL,EAApD,CAAb;;AAEA,IAAI,QAAQ;AACR,UAAM,KAAK,IAAL,CAAU,MAAV,EAAkB,SAAlB,CADE;AAER,YAAQ,KAAK,IAAL,CAAU,MAAV,EAAkB,WAAlB;AAFA,CAAZ;;AAKA,OAAO,IAAP,CAAY,MAAZ;AACA,GAAG,aAAH,CAAiB,MAAM,IAAvB,EAA6B,kBAA7B;;AAEA,KAAK,KAAL,EAAY,UAAU,CAAV,EAAa;AACrB,MAAE,IAAF,CAAO,CAAP;AACA,QAAI,KAAK,MAAM,GAAN,EAAW,CAAE,MAAM,IAAR,EAAc,IAAd,EAAoB,MAAM,MAA1B,EAAkC,IAAlC,CAAX,CAAT;AACA,QAAI,UAAU,CAAd;AACA,OAAG,MAAH,CAAU,IAAV,CAAe,OAAf,EAAwB,EAAxB,CAA2B,MAA3B,EAAmC,UAAU,IAAV,EAAgB;AAC/C;AACA,YAAI,YAAY,CAAhB,EAAmB;AACf,gBAAI,MAAM,MAAV,EAAkB,UAAU,GAAV,EAAe,MAAf,EAAuB;AACrC,kBAAE,OAAF,CAAU,GAAV;AACA,kBAAE,KAAF,CAAQ,MAAR,EAAgB,OAAhB;AACA,mBAAG,SAAH,CAAa,MAAM,IAAnB,EAAyB,kBAAzB;AACH,aAJD;AAKH,SAND,MAOK,IAAI,YAAY,CAAhB,EAAmB;AACpB,gBAAI,MAAM,MAAV,EAAkB,UAAU,GAAV,EAAe,MAAf,EAAuB;AACrC,kBAAE,OAAF,CAAU,GAAV;AACA,kBAAE,KAAF,CAAQ,MAAR,EAAgB,OAAhB;AACA,mBAAG,IAAH;AACH,aAJD;AAKH;AACJ,KAhBD;AAiBH,CArBD;;AAuBA,SAAS,GAAT,CAAc,IAAd,EAAoB,EAApB,EAAwB;AACpB,QAAI,KAAK,MAAM,QAAQ,QAAd,EAAwB,CAAE,IAAF,CAAxB,CAAT;AACA,QAAI,OAAO,EAAX;AACA,OAAG,MAAH,CAAU,EAAV,CAAa,MAAb,EAAqB,UAAU,GAAV,EAAe;AAAE,aAAK,IAAL,CAAU,GAAV;AAAgB,KAAtD;AACA,OAAG,MAAH,CAAU,EAAV,CAAa,KAAb,EAAoB,YAAY;AAC5B,WAAG,IAAH,EAAS,OAAO,MAAP,CAAc,IAAd,EAAoB,QAApB,CAA6B,MAA7B,CAAT;AACH,KAFD;AAGA,OAAG,EAAH,CAAM,OAAN,EAAe,EAAf;AACA,WAAO,EAAP;AACH","file":"bin.js","sourcesContent":["var test = require('tape');\nvar fs = require('fs');\nvar path = require('path');\nvar mkdirp = require('mkdirp');\nvar spawn = require('win-spawn');\nvar split = require('split');\n\nvar cmd = path.resolve(__dirname, '../bin/cmd.js');\nvar os = require('os');\nvar tmpdir = path.join((os.tmpdir || os.tmpDir)(), 'watchify-' + Math.random());\n\nvar files = {\n    main: path.join(tmpdir, 'main.js'),\n    bundle: path.join(tmpdir, 'bundle.js')\n};\n\nmkdirp.sync(tmpdir);\nfs.writeFileSync(files.main, 'console.log(555)');\n\ntest('bin', function (t) {\n    t.plan(4);\n    var ps = spawn(cmd, [ files.main, '-o', files.bundle, '-v' ]);\n    var lineNum = 0;\n    ps.stderr.pipe(split()).on('data', function (line) {\n        lineNum ++;\n        if (lineNum === 1) {\n            run(files.bundle, function (err, output) {\n                t.ifError(err);\n                t.equal(output, '555\\n');\n                fs.writeFile(files.main, 'console.log(333)');\n            })\n        }\n        else if (lineNum === 2) {\n            run(files.bundle, function (err, output) {\n                t.ifError(err);\n                t.equal(output, '333\\n');\n                ps.kill();\n            });\n        }\n    });\n});\n\nfunction run (file, cb) {\n    var ps = spawn(process.execPath, [ file ]);\n    var data = [];\n    ps.stdout.on('data', function (buf) { data.push(buf) });\n    ps.stdout.on('end', function () {\n        cb(null, Buffer.concat(data).toString('utf8'));\n    });\n    ps.on('error', cb);\n    return ps;\n}\n"]}