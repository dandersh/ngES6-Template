{"version":3,"sources":["../../../../node_modules/watchify/test/api_brfs.js"],"names":[],"mappings":";;AAAA,IAAI,OAAO,QAAQ,MAAR,CAAX;AACA,IAAI,WAAW,QAAQ,KAAR,CAAf;AACA,IAAI,aAAa,QAAQ,YAAR,CAAjB;AACA,IAAI,KAAK,QAAQ,IAAR,CAAT;;AAEA,IAAI,KAAK,QAAQ,IAAR,CAAT;AACA,IAAI,OAAO,QAAQ,MAAR,CAAX;AACA,IAAI,SAAS,QAAQ,QAAR,CAAb;;AAEA,IAAI,KAAK,QAAQ,IAAR,CAAT;AACA,IAAI,SAAS,KAAK,IAAL,CAAU,CAAC,GAAG,MAAH,IAAa,GAAG,MAAjB,GAAV,EAAsC,cAAc,KAAK,MAAL,EAApD,CAAb;;AAEA,IAAI,QAAQ;AACR,UAAM,KAAK,IAAL,CAAU,MAAV,EAAkB,SAAlB,CADE;AAER,WAAO,KAAK,IAAL,CAAU,MAAV,EAAkB,WAAlB;AAFC,CAAZ;;AAKA,OAAO,IAAP,CAAY,MAAZ;AACA,GAAG,aAAH,CAAiB,MAAM,IAAvB,EAA6B,CACzB,yBADyB,EAEzB,8DAFyB,EAGzB,iCAHyB,EAI3B,IAJ2B,CAItB,IAJsB,CAA7B;AAKA,GAAG,aAAH,CAAiB,MAAM,KAAvB,EAA8B,YAA9B;;AAEA,KAAK,eAAL,EAAsB,UAAU,CAAV,EAAa;AAC/B,MAAE,IAAF,CAAO,CAAP;AACA,QAAI,IAAI,SAAS,WAAW,MAAM,IAAjB,EAAuB,SAAS,IAAhC,CAAT,CAAR;AACA,MAAE,SAAF,CAAY,MAAZ;AACA,MAAE,EAAF,CAAK,QAAL,EAAe,YAAY;AACvB,UAAE,MAAF,CAAS,UAAU,GAAV,EAAe,GAAf,EAAoB;AACzB,cAAE,OAAF,CAAU,GAAV;AACA,cAAE,KAAF,CAAQ,IAAI,GAAJ,CAAR,EAAkB,eAAlB;AACA,cAAE,KAAF;AACH,SAJD;AAKH,KAND;AAOA,MAAE,MAAF,CAAS,UAAU,GAAV,EAAe,GAAf,EAAoB;AACzB,UAAE,OAAF,CAAU,GAAV;AACA,UAAE,KAAF,CAAQ,IAAI,GAAJ,CAAR,EAAkB,cAAlB;AACA,mBAAW,YAAY;AACnB,eAAG,SAAH,CAAa,MAAM,KAAnB,EAA0B,aAA1B,EAAyC,UAAU,GAAV,EAAe;AACpD,kBAAE,OAAF,CAAU,GAAV;AACH,aAFD;AAGH,SAJD,EAIG,IAJH;AAKH,KARD;AASH,CApBD;;AAsBA,SAAS,GAAT,CAAc,GAAd,EAAmB;AACf,QAAI,SAAS,EAAb;AACA,aAAS,GAAT,CAAc,GAAd,EAAmB;AAAE,kBAAU,MAAM,IAAhB;AAAsB;AAC3C,OAAG,eAAH,CAAmB,GAAnB,EAAwB,EAAE,SAAS,EAAE,KAAK,GAAP,EAAX,EAAxB;AACA,WAAO,MAAP;AACH","file":"api_brfs.js","sourcesContent":["var test = require('tape');\nvar watchify = require('../');\nvar browserify = require('browserify');\nvar vm = require('vm');\n\nvar fs = require('fs');\nvar path = require('path');\nvar mkdirp = require('mkdirp');\n\nvar os = require('os');\nvar tmpdir = path.join((os.tmpdir || os.tmpDir)(), 'watchify-' + Math.random());\n\nvar files = {\n    main: path.join(tmpdir, 'main.js'),\n    lines: path.join(tmpdir, 'lines.txt')\n};\n\nmkdirp.sync(tmpdir);\nfs.writeFileSync(files.main, [\n    'var fs = require(\"fs\");',\n    'var src = fs.readFileSync(__dirname + \"/lines.txt\", \"utf8\");',\n    'console.log(src.toUpperCase());'\n].join('\\n'));\nfs.writeFileSync(files.lines, 'beep\\nboop');\n\ntest('api with brfs', function (t) {\n    t.plan(5);\n    var w = watchify(browserify(files.main, watchify.args));\n    w.transform('brfs');\n    w.on('update', function () {\n        w.bundle(function (err, src) {\n            t.ifError(err);\n            t.equal(run(src), 'ROBO-BOOGIE\\n');\n            w.close();\n        });\n    });\n    w.bundle(function (err, src) {\n        t.ifError(err);\n        t.equal(run(src), 'BEEP\\nBOOP\\n');\n        setTimeout(function () {\n            fs.writeFile(files.lines, 'rObO-bOOgie', function (err) {\n                t.ifError(err);\n            });\n        }, 1000);\n    });\n});\n\nfunction run (src) {\n    var output = '';\n    function log (msg) { output += msg + '\\n' }\n    vm.runInNewContext(src, { console: { log: log } });\n    return output;\n}\n"]}