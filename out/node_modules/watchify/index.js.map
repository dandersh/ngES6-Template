{"version":3,"sources":["../../../node_modules/watchify/index.js"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["var through = require('through2');\nvar path = require('path');\nvar chokidar = require('chokidar');\nvar xtend = require('xtend');\nvar anymatch = require('anymatch');\n\nmodule.exports = watchify;\nmodule.exports.args = {\n    cache: {}, packageCache: {}\n};\n\nfunction watchify (b, opts) {\n    if (!opts) opts = {};\n    var cache = b._options.cache;\n    var pkgcache = b._options.packageCache;\n    var delay = typeof opts.delay === 'number' ? opts.delay : 100;\n    var changingDeps = {};\n    var pending = false;\n    var updating = false;\n    \n    var wopts = {persistent: true};\n    if (opts.ignoreWatch) {\n        var ignored = opts.ignoreWatch !== true\n            ? opts.ignoreWatch\n            : '**/node_modules/**';\n    }\n    if (opts.poll || typeof opts.poll === 'number') {\n        wopts.usePolling = true;\n        wopts.interval = opts.poll !== true\n            ? opts.poll\n            : undefined;\n    }\n\n    if (cache) {\n        b.on('reset', collect);\n        collect();\n    }\n    \n    function collect () {\n        b.pipeline.get('deps').push(through.obj(function(row, enc, next) {\n            var file = row.expose ? b._expose[row.id] : row.file;\n            cache[file] = {\n                source: row.source,\n                deps: xtend(row.deps)\n            };\n            this.push(row);\n            next();\n        }));\n    }\n    \n    b.on('file', function (file) {\n        watchFile(file);\n    });\n    \n    b.on('package', function (pkg) {\n        var file = path.join(pkg.__dirname, 'package.json');\n        watchFile(file);\n        if (pkgcache) pkgcache[file] = pkg;\n    });\n    \n    b.on('reset', reset);\n    reset();\n    \n    function reset () {\n        var time = null;\n        var bytes = 0;\n        b.pipeline.get('record').on('end', function () {\n            time = Date.now();\n        });\n        \n        b.pipeline.get('wrap').push(through(write, end));\n        function write (buf, enc, next) {\n            bytes += buf.length;\n            this.push(buf);\n            next();\n        }\n        function end () {\n            var delta = Date.now() - time;\n            b.emit('time', delta);\n            b.emit('bytes', bytes);\n            b.emit('log', bytes + ' bytes written ('\n                + (delta / 1000).toFixed(2) + ' seconds)'\n            );\n            this.push(null);\n        }\n    }\n    \n    var fwatchers = {};\n    var fwatcherFiles = {};\n    var ignoredFiles = {};\n    \n    b.on('transform', function (tr, mfile) {\n        tr.on('file', function (dep) {\n            watchFile(mfile, dep);\n        });\n    });\n    b.on('bundle', function (bundle) {\n        updating = true;\n        bundle.on('error', onend);\n        bundle.on('end', onend);\n        function onend () { updating = false }\n    });\n\n    function watchFile (file, dep) {\n        dep = dep || file;\n        if (ignored) {\n            if (!ignoredFiles.hasOwnProperty(file)) {\n                ignoredFiles[file] = anymatch(ignored, file);\n            }\n            if (ignoredFiles[file]) return;\n        }\n        if (!fwatchers[file]) fwatchers[file] = [];\n        if (!fwatcherFiles[file]) fwatcherFiles[file] = [];\n        if (fwatcherFiles[file].indexOf(dep) >= 0) return;\n\n        var w = b._watcher(dep, wopts);\n        w.setMaxListeners(0);\n        w.on('error', b.emit.bind(b, 'error'));\n        w.on('change', function () {\n            invalidate(file);\n        });\n        fwatchers[file].push(w);\n        fwatcherFiles[file].push(dep);\n    }\n    \n    function invalidate (id) {\n        if (cache) delete cache[id];\n        if (pkgcache) delete pkgcache[id];\n        changingDeps[id] = true;\n        \n        if (!updating && fwatchers[id]) {\n            fwatchers[id].forEach(function (w) {\n                w.close();\n            });\n            delete fwatchers[id];\n            delete fwatcherFiles[id];\n        }\n        \n        // wait for the disk/editor to quiet down first:\n        if (pending) clearTimeout(pending);\n        pending = setTimeout(notify, delay);\n    }\n    \n    function notify () {\n        if (updating) {\n            pending = setTimeout(notify, delay);\n        } else {\n            pending = false;\n            b.emit('update', Object.keys(changingDeps));\n            changingDeps = {};\n        }\n    }\n    \n    b.close = function () {\n        Object.keys(fwatchers).forEach(function (id) {\n            fwatchers[id].forEach(function (w) { w.close() });\n        });\n    };\n    \n    b._watcher = function (file, opts) {\n        return chokidar.watch(file, opts);\n    };\n\n    return b;\n}\n"]}